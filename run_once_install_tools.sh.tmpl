#!/usr/bin/env bash
set -euo pipefail

echo "ðŸ”§ Installing essential tools (zsh, curl, git, unzip)..."
sudo apt update
sudo apt install -y zsh curl git unzip wget tar

# --- Starship ---
if ! command -v starship >/dev/null 2>&1; then
  echo "ðŸš€ Installing Starship prompt..."
  sh -c "$(curl -fsSL https://starship.rs/install.sh)" -- -y
else
  echo "âœ… Starship already installed."
fi

# --- eza (modern ls replacement) ---
if ! command -v eza >/dev/null 2>&1; then
  echo "ðŸ“¦ Installing eza..."
  TMP_DIR=$(mktemp -d)
  cd "$TMP_DIR"

  wget -q https://github.com/eza-community/eza/releases/latest/download/eza_x86_64-unknown-linux-gnu.tar.gz
  tar -xvzf eza_x86_64-unknown-linux-gnu.tar.gz

  # Move binary into ~/.local/bin (preferred for user installs)
  mkdir -p "$HOME/.local/bin"
  mv eza "$HOME/.local/bin/"

  cd -
  rm -rf "$TMP_DIR"
else
  echo "âœ… eza already installed."
fi

# Install fontconfig if missing
if ! command -v fc-cache >/dev/null 2>&1; then
    echo "ðŸ”§ Installing fontconfig..."
    sudo apt-get update
    sudo apt-get install -y fontconfig
fi

# --- Fonts (FiraCode Nerd Font example) ---
if [ ! -f "$HOME/.local/share/fonts/FiraCodeNerdFontMono-Regular.ttf" ]; then
  echo "ðŸ”¤ Installing FiraCode Nerd Font..."
  mkdir -p "$HOME/.local/share/fonts"
  TMP_FONT=$(mktemp -d)
  cd "$TMP_FONT"

  wget -q https://github.com/ryanoasis/nerd-fonts/releases/latest/download/FiraCode.zip
  unzip -o FiraCode.zip -d "$HOME/.local/share/fonts"

  fc-cache -f
  cd -
  rm -rf "$TMP_FONT"
else
  echo "âœ… FiraCode Nerd Font already installed."
fi

# --- Oh My Zsh ---
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  echo "ðŸ’¡ Installing Oh My Zsh..."
  RUNZSH=no CHSH=no KEEP_ZSHRC=yes \
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
else
  echo "âœ… Oh My Zsh already installed."
fi

# --- Oh My Zsh plugins ---
ZSH_CUSTOM="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}"

if [ ! -d "$ZSH_CUSTOM/plugins/zsh-autosuggestions" ]; then
  echo "ðŸ”Œ Installing zsh-autosuggestions..."
  git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions
else
  echo "âœ… zsh-autosuggestions already installed."
fi

if [ ! -d "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting" ]; then
  echo "ðŸ”Œ Installing zsh-syntax-highlighting..."
  git clone https://github.com/zsh-users/zsh-syntax-highlighting $ZSH_CUSTOM/plugins/zsh-syntax-highlighting
else
  echo "âœ… zsh-syntax-highlighting already installed."
fi

echo "ðŸŽ‰ All tools installed."
